<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.kosa.kapple.mapper.MapperKW">
    <select id="test" resultType="Date">
        select sysdate from dual
    </select>
    <resultMap type="SupplierVO" id="supplierMap">
        <id property="suppl_no" column="suppl_no"/>
        <result property="suppl_no" column="suppl_no"/>
        <result property="suppl_name" column="suppl_name"/>
        <result property="ceo_name" column="ceo_name"/>
        <result property="category" column="category"/>
        <result property="phone" column="phone"/>
        <collection property="transport" resultMap="transportMap"></collection>
    </resultMap>
    <resultMap type="TransportationVO" id="transportMap">
        <id property="transport_no" column="transport_no"/>
        <result property="transport_no" column="transport_no"/>
        <result property="transport_category" column="transport_category"/>
        <result property="transport_charge" column="transport_charge"/>
        <result property="additional_condition" column="additional_condition"/>
    </resultMap>

    <!-- 공급사 리스트 -->
    <select id="getAll" resultMap="supplierMap" parameterType="String">
		<![CDATA[
        select *
        from supplier s join proposal p
            on s.suppl_no=p.suppl_no join component c
                on p.compo_no=c.compo_no join transportation t
                    on s.transport_no=t.transport_no
        where c.compo_name = #{compo_name}
        ]]>
	</select>

    <resultMap type="ProposalVO" id="proposalMap">
        <id property="proposal_no" column="proposal_no"/>
        <result property="proposal_no" column="proposal_no"/>
        <result property="price" column="price"/>
        <result property="quantity" column="quantity"/>
        <result property="defective_rate" column="defective_rate"/>
        <result property="quality_grade" column="quality_grade"/>
        <result property="prod_period" column="prod_period"/>
        <result property="proposal_date" column="proposal_date"/>
        <collection property="supplier" resultMap="supplierMap"></collection>
        <collection property="component" resultMap="componentMap"></collection>
    </resultMap>
    <resultMap type="ComponentVO" id="componentMap">
        <id property="compo_no" column="compo_no"/>
        <result property="compo_no" column="compo_no"/>
        <result property="compo_name" column="compo_name"/>
        <result property="unit" column="unit"/>
        <result property="detail" column="detail"/>
    </resultMap>

    <select id="getProposal" resultMap="proposalMap">
		<![CDATA[
        select *
        from proposal p full outer join supplier s
                                        on p.suppl_no=s.suppl_no full outer join component c
                                                                                 on p.compo_no=c.compo_no
        where compo_name=#{compo_name} and p.suppl_no=#{suppl_no}
        ]]>
	</select>
    <select id="getProposaltoContract" resultMap="proposalMap">
        select *
        from proposal p full outer join supplier s
                on p.suppl_no=s.suppl_no full outer join component c
                on p.compo_no=c.compo_no
        where p.proposal_no=#{proposal_no}
    </select>
    <insert id="saveContract">
        insert into contract values (#{contract_no},#{suppl_no},#{compo_no},#{start_date},#{end_date},#{contract_date},#{proposal_no})
    </insert>
    <update id="upProposalStat">
        update proposal set status='1' where proposal_no=#{proposal_no}
    </update>
    <select id="lastSEQ">
            SELECT
            LAST_NUMBER
            FROM
            USER_SEQUENCES
            WHERE
            SEQUENCE_NAME = 'CONTRACT_SEQ'
    </select>
</mapper>